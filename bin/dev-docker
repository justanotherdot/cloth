#!/bin/sh -eu

echo "Starting Cloth development environment with Docker..."

# Navigate to git project root
PROJECT_ROOT="$(git rev-parse --show-toplevel)"
cd "$PROJECT_ROOT"

# Check if Docker is available
if ! command -v docker >/dev/null 2>&1; then
    echo "Error: Docker not found. Please install Docker."
    exit 1
fi

# Try Docker Compose V2 first, then V1
if docker compose version >/dev/null 2>&1; then
    COMPOSE_CMD="docker compose"
elif command -v docker-compose >/dev/null 2>&1; then
    COMPOSE_CMD="docker-compose"
else
    echo "Error: Docker Compose not found. Please install Docker Compose."
    exit 1
fi

echo "Starting services..."
$COMPOSE_CMD up -d

echo ""
echo "Waiting for services to be healthy..."
$COMPOSE_CMD ps

echo ""
echo "Development servers:"
echo "  API Worker: http://localhost:8787"
echo "  Frontend Worker: http://localhost:3000"
echo ""
echo "API Authentication: admin / dev123"
echo ""
echo "To view logs: docker-compose logs -f"
echo "To stop: docker-compose down"