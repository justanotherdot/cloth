#!/bin/sh -eu

echo "Running Cloth test suite..."

echo "1. Unit tests (cloth-core)..."
cargo test --package cloth-core --quiet

echo "2. Build validation tests..."
bin/test-build

echo "3. Regression tests..."
bin/test-regressions

echo "4. Integration tests (cloth-api)..."
# TODO: Add WASM integration tests when ready
echo "  â†’ Integration tests pending (requires test harness)"

echo "5. E2E tests..."
if [ -d "tests/e2e/node_modules" ]; then
    cd tests/e2e && npm test
    cd ../..
else
    echo "  â†’ E2E tests pending (run: cd tests/e2e && npm install)"
fi

echo "6. Build artifacts validation..."
# Only test build artifacts, not live deployments
if [ -d "frontend/build/client" ]; then
    echo "  â†’ Testing generated build artifacts"
    # Test that proper files are generated without hitting live URLs
else
    echo "  â†’ No build artifacts found (run: npm run build)"
fi

echo "âœ… Test suite complete!"
echo ""
echo "ðŸ’¡ After deployment, run: bin/test-smoke"